
  <div class="footer">
    &copy; 2022 Onafriq Mauritius. All rights reserved.
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCbuLoyGu6v7dJUDQ0iM2DkvEZs0D9z2Do",
      authDomain: "mfs-africa-ltd.firebaseapp.com",
      databaseURL: "https://mfs-africa-ltd-default-rtdb.firebaseio.com",
      projectId: "mfs-africa-ltd",
      storageBucket: "mfs-africa-ltd.appspot.com",
      messagingSenderId: "686833267635",
      appId: "1:686833267635:web:c5a531346887f6452bd1c6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const welcomeEl = document.getElementById("welcomeMessage");

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const uid = user.uid;
        const userRef = ref(db, `users/${uid}`);
        try {
          const snapshot = await get(userRef);
          if (snapshot.exists()) {
            const data = snapshot.val();
            welcomeEl.textContent = `Welcome, ${data.username || "User"}!`;

            const watched = data.watchedVideos || {};

            document.querySelectorAll('.earn-btn').forEach(button => {
              const videoId = button.dataset.videoId;
              if (watched[videoId]) {
                button.disabled = true;
                button.textContent = "Already Earned";
              }

              button.addEventListener('click', async () => {
                if (watched[videoId]) return;

                const earnAmount = 25500;
                const currentTotal = parseInt(data.totalEarn) || 0;
                const currentBalance = parseInt(data.balance) || 0;

                const newTotal = currentTotal + earnAmount;
                const newBalance = currentBalance + earnAmount;

                watched[videoId] = true;

                await update(userRef, {
                  totalEarn: newTotal,
                  balance: newBalance,
                  watchedVideos: watched
                });

                button.disabled = true;
                button.textContent = "Already Earned";
                alert(`âœ… RWF 25,500 added to your earnings and balance!`);
              });
            });
          }
        } catch (error) {
          console.error("Error:", error);
        }
      } else {
        window.location.href = "Login.html";
      }
    });

    function toggleMenu() {
      const menu = document.getElementById("dropdownMenu");
      menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    }

    document.addEventListener('click', function(event) {
      const menu = document.getElementById("dropdownMenu");
      const icon = document.querySelector('.menu-icon');
      if (!menu.contains(event.target) && !icon.contains(event.target)) {
        menu.style.display = "none";
      }
    });
  </script>
</body>
</html>